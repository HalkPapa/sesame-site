# Sesame Theme トラブルシューティングガイド

このガイドでは、Sesame Themeで発生する可能性のある問題とその解決方法を説明します。

## 📋 目次

1. [インストール時の問題](#インストール時の問題)
2. [ページ表示の問題](#ページ表示の問題)
3. [スタイル・デザインの問題](#スタイルデザインの問題)
4. [機能の問題](#機能の問題)
5. [パフォーマンスの問題](#パフォーマンスの問題)
6. [緊急時の対応](#緊急時の対応)

---

## インストール時の問題

### テーマをアップロードできない

#### 症状
- 「アップロードしたファイルは php.ini で定義された upload_max_filesize を超過しています。」というエラー

#### 原因
- サーバーのファイルサイズ制限

#### 解決方法

**方法1: FTP経由でアップロード**
1. zipファイルを解凍
2. FTPクライアントでサーバーに接続
3. `/wp-content/themes/` に `sesame-theme` フォルダをアップロード
4. 管理画面でテーマを有効化

**方法2: php.ini の変更（サーバー管理者に相談）**
```ini
upload_max_filesize = 64M
post_max_size = 64M
```

### テーマが有効化できない

#### 症状
- 「壊れたテーマ」と表示される

#### 原因
- ファイルが不完全
- 必須ファイルの欠落

#### 解決方法
1. テーマファイルを再ダウンロード
2. 解凍せずにそのままアップロード
3. または、FTPで完全なファイルをアップロード

---

## ページ表示の問題

### 404エラー - ページが見つからない

#### 症状
- 実績詳細ページが404エラー
- その他のページが表示されない

#### 原因
- パーマリンク設定が更新されていない

#### 解決方法（必須！）

1. WordPress管理画面にログイン
2. **設定** → **パーマリンク** をクリック
3. 何も変更せず **変更を保存** をクリック

これだけで解決します。

### ページが真っ白になる

#### 症状
- サイトが表示されない
- 真っ白な画面

#### 原因
- PHPエラー
- functions.php の構文エラー

#### 解決方法

**方法1: エラーログを確認**
```
/wp-content/debug.log
```

**方法2: FTP経由で修正**
1. FTPでサーバーに接続
2. 問題のあるファイルを元に戻す
3. または、`sesame-theme` フォルダの名前を変更して一時的に無効化

**方法3: wp-config.php でデバッグモードを有効化**
```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
```

### レイアウトが崩れる

#### 症状
- デザインが意図通りに表示されない
- 要素が重なっている

#### 原因
- CSSの競合
- ブラウザのキャッシュ

#### 解決方法

**ステップ1: キャッシュをクリア**
```
Ctrl + Shift + Delete (Windows/Linux)
Cmd + Shift + Delete (Mac)
```
または
```
Ctrl + Shift + R でスーパーリロード
```

**ステップ2: ブラウザの開発者ツールで確認**
1. F12キーを押す
2. Console タブでエラーを確認
3. Elements タブでCSSを確認

**ステップ3: キャッシュプラグインをクリア**
- WP Super Cache
- W3 Total Cache
- その他のキャッシュプラグイン

---

## スタイル・デザインの問題

### CSSが反映されない

#### 症状
- style.css を変更したのに反映されない

#### 原因
- ブラウザキャッシュ
- サーバーキャッシュ
- CDNキャッシュ

#### 解決方法

**ステップ1: ブラウザキャッシュをクリア**
```
Ctrl + Shift + Delete
```

**ステップ2: スーパーリロード**
```
Ctrl + Shift + R (Windows/Linux)
Cmd + Shift + R (Mac)
```

**ステップ3: キャッシュプラグインをクリア**
管理画面からキャッシュをクリア

**ステップ4: バージョン番号を変更**
`functions.php` で：

```php
wp_enqueue_style('sesame-style', get_stylesheet_uri(), array(), '1.1'); // 1.0 → 1.1
```

### フォントが表示されない

#### 症状
- Google Fonts が読み込まれない

#### 原因
- ネットワークエラー
- functions.php の記述ミス

#### 解決方法

**ステップ1: functions.php を確認**
```php
wp_enqueue_style(
    'sesame-google-fonts',
    'https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap',
    array(),
    null
);
```

**ステップ2: ブラウザのConsoleでエラー確認**
F12 → Console タブ

**ステップ3: フォールバックフォントを確認**
```css
font-family: 'Noto Sans JP', sans-serif;
```

### 画像が表示されない

#### 症状
- アイキャッチ画像が表示されない
- 画像が壊れて表示される

#### 原因
- ファイルパスが間違っている
- 画像がアップロードされていない
- パーミッション問題

#### 解決方法

**ステップ1: 画像が設定されているか確認**
1. 投稿編集画面
2. **実績画像を設定** で画像を確認

**ステップ2: 画像を再アップロード**
1. 画像を削除
2. 新しく画像をアップロード

**ステップ3: パーミッションを確認**
```
/wp-content/uploads/ のパーミッションが 755 または 775
```

---

## 機能の問題

### メニューが表示されない

#### 症状
- ナビゲーションメニューが表示されない

#### 原因
- メニューが作成されていない
- メニュー位置が設定されていない

#### 解決方法

1. **外観** → **メニュー**
2. 新しいメニューを作成
3. ページを追加
4. **メニューの位置** で「Primary Menu」にチェック
5. **メニューを保存**

詳細は `navigation-setup-guide.md` 参照

### 実績が表示されない

#### 症状
- Workページに実績が表示されない

#### 原因
- 実績が投稿されていない
- パーマリンク設定の問題

#### 解決方法

**ステップ1: 実績を投稿**
1. **実績** → **新規追加**
2. タイトル、本文、画像を設定
3. **公開**

**ステップ2: パーマリンク設定を更新**
1. **設定** → **パーマリンク**
2. **変更を保存**

**ステップ3: テンプレートを確認**
固定ページで「Work Page」テンプレートが選択されているか確認

### Contact Form 7が表示されない

#### 症状
- お問い合わせフォームが表示されない

#### 原因
- Contact Form 7がインストールされていない
- フォームが作成されていない

#### 解決方法

**ステップ1: プラグインを確認**
1. **プラグイン** → **インストール済みプラグイン**
2. Contact Form 7 が有効化されているか確認

**ステップ2: フォームを作成**
1. **お問い合わせ** → **新規追加**
2. フォームコードを入力（`contact-form-code.md` 参照）
3. **保存**

**ステップ3: ページを確認**
固定ページで「Contact Page」テンプレートが選択されているか確認

詳細は `contact-setup-guide.md` 参照

### 実績詳細ページにリンクできない

#### 症状
- 実績をクリックしても詳細ページに移動しない

#### 原因
- パーマリンク設定の問題
- JavaScriptのエラー

#### 解決方法

**ステップ1: パーマリンク設定を更新**
1. **設定** → **パーマリンク**
2. **変更を保存**

**ステップ2: ブラウザのConsoleを確認**
F12 → Console タブでエラーを確認

**ステップ3: リンクを確認**
`template-work.php` で：

```php
<a href="<?php the_permalink(); ?>">
    <?php the_post_thumbnail('large'); ?>
</a>
```

---

## パフォーマンスの問題

### サイトの読み込みが遅い

#### 症状
- ページの表示に時間がかかる

#### 原因
- 画像サイズが大きすぎる
- キャッシュが有効になっていない

#### 解決方法

**ステップ1: 画像を最適化**
1. 画像圧縮プラグインを使用（Smush、Imagify など）
2. 推奨画像サイズ：横幅800-1200px、100KB以下

**ステップ2: キャッシュプラグインをインストール**
- WP Super Cache
- W3 Total Cache
- WP Fastest Cache

**ステップ3: 不要なプラグインを削除**
使用していないプラグインを無効化・削除

### 管理画面が遅い

#### 症状
- WordPress管理画面の動作が重い

#### 原因
- サーバーリソース不足
- データベースの肥大化

#### 解決方法

**ステップ1: リビジョンを削除**
プラグイン「WP-Optimize」を使用

**ステップ2: データベースを最適化**
phpMyAdmin または WP-Optimize で最適化

**ステップ3: サーバープランを見直す**
より高性能なサーバーへの移行を検討

---

## 緊急時の対応

### サイトがダウンした

#### 即座に行うこと

**ステップ1: 管理画面にアクセスできるか確認**
```
https://yoursite.com/wp-admin
```

**ステップ2: FTPでアクセス**
1. FTPクライアントでサーバーに接続
2. `/wp-content/themes/sesame-theme/` の名前を変更
   例: `sesame-theme-backup`
3. デフォルトテーマが自動的に有効化される

**ステップ3: エラーログを確認**
```
/wp-content/debug.log
/error_log
```

### カスタマイズ後に問題が発生

#### ステップ1: 最後の変更を元に戻す

**変更したファイルをバックアップから復元**

FTP経由で：
1. バックアップファイルをアップロード
2. 既存ファイルを上書き

**ステップ2: キャッシュをクリア**

ブラウザとサーバーのキャッシュをクリア

**ステップ3: 段階的に変更を再適用**

1つずつ変更を加えて、どこで問題が発生するか特定

### データベースの問題

#### 症状
- データベース接続エラー

#### 解決方法

**ステップ1: wp-config.php を確認**
```php
define('DB_NAME', 'database_name');
define('DB_USER', 'database_user');
define('DB_PASSWORD', 'database_password');
define('DB_HOST', 'localhost');
```

**ステップ2: データベースの復元**

バックアッププラグインからデータベースを復元

**ステップ3: ホスティング会社に連絡**

サーバー側の問題の可能性

---

## よくある質問

### Q: テーマを更新するとカスタマイズが消える？

**A:** はい、テーマファイルを直接編集した場合、更新で消えます。

**解決策:**
1. 子テーマを使用する
2. カスタムCSSはカスタマイザーの「追加CSS」に記述
3. 重要なカスタマイズはバックアップを取る

### Q: エラーメッセージが表示される

**A:** エラーメッセージの内容を確認してください。

**よくあるエラー:**

```
Parse error: syntax error, unexpected...
→ PHPの構文エラー。閉じ括弧などを確認
```

```
Fatal error: Cannot redeclare function...
→ 関数名の重複。関数名を変更
```

```
Warning: Cannot modify header information...
→ ファイルに余分な空白や改行がある
```

### Q: 画像がぼやける

**A:** 画像サイズが適切か確認してください。

**推奨サイズ:**
- アイキャッチ画像: 1200 x 800px
- ロゴ: 400 x 100px

### Q: スマホで表示が崩れる

**A:** ブラウザのキャッシュをクリアしてください。

**確認方法:**
1. Chromeのデベロッパーツール（F12）
2. デバイスツールバーをクリック（Ctrl+Shift+M）
3. 各デバイスで表示を確認

---

## デバッグモード

### デバッグモードの有効化

`wp-config.php` に以下を追加：

```php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
define('SCRIPT_DEBUG', true);
```

エラーログの場所：
```
/wp-content/debug.log
```

### デバッグの無効化（本番環境）

```php
define('WP_DEBUG', false);
```

---

## サポートへの問い合わせ前チェックリスト

問題が解決しない場合は、以下の情報を用意してください：

- [ ] WordPress バージョン
- [ ] PHP バージョン
- [ ] 使用中のプラグイン一覧
- [ ] エラーメッセージの全文
- [ ] 問題が発生する具体的な手順
- [ ] スクリーンショット
- [ ] 最近行った変更内容

---

## 予防策

### 定期的なバックアップ

**推奨頻度:**
- サイト全体: 週1回
- データベース: 毎日
- カスタマイズしたファイル: 変更ごと

**推奨プラグイン:**
- UpdraftPlus
- BackWPup
- All-in-One WP Migration

### 更新前の確認

1. バックアップを取る
2. ステージング環境でテスト
3. プラグインの互換性を確認
4. 本番環境で更新

### セキュリティ

1. WordPressを最新版に保つ
2. 強力なパスワードを使用
3. セキュリティプラグインをインストール（Wordfence など）
4. 定期的にログを確認

---

## 追加リソース

### 公式ドキュメント
- WordPress Codex: https://codex.wordpress.org/
- WordPress サポートフォーラム: https://ja.wordpress.org/support/

### コミュニティ
- Stack Overflow
- Reddit: r/wordpress
- Facebook グループ

### ツール
- ブラウザ開発者ツール（F12）
- PageSpeed Insights
- GTmetrix

---

このガイドで問題が解決しない場合は：

1. エラーメッセージを正確に記録
2. 最近の変更内容を確認
3. バックアップから復元
4. 専門家に相談

**緊急時は、まずバックアップから復元することを最優先してください。**
